name: Build Docker image # Name of the workflow

# Trigger workflow on push to main branch
on:
  push:
    branches: [main]

jobs:
    build: # Define a job called 'build'
        runs-on: ubuntu-latest # Use the latest Ubuntu runner
        steps:
            # Version numebers got from ChatGPT on 2025-12-14
            - name: Checkout # Step: check out the repository code
              uses: actions/checkout@v4 # Use the official checkout action

            - name: Set up Docker Buildx # Step: set up Docker Buildx for multi-platform builds
              uses: docker/setup-buildx-action@v3 # Use the official Buildx setup action

            - name: Log in to GitHub Container Registry # Step: log in to GitHub Container Registry
              uses: docker/login-action@v3 # Use the official Docker login action
              with:
                  registry: ghcr.io # Set registry to GitHub Container Registry
                  username: ${{ github.actor }} # Use the GitHub Actions actor as username
                  password: ${{ secrets.GHCR_PAT }} # Use a secret token for authentication

            - name: Build and push image (multi-platform) # Step: build and push Docker image for multiple platforms
              uses: docker/build-push-action@v5 # Use the official Docker build-push action
              with:
                  context: . # Build context is the root of the repository
                  platforms: linux/amd64,linux/arm64 # Build for both amd64 and arm64 architectures
                  tags: |
                      ghcr.io/silentnille/frontend-image:latest
                      ghcr.io/silentnille/frontend-image:${{ github.sha }}
